<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistema de Gestión Piscícola</title>
    <link rel="stylesheet" href="/Pagina_web/CSS/style_dashboard.css">
</head>
<body>
    <button class="mobile-menu-btn" onclick="toggleSidebar()">☰</button>
    
    
    <script>
        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar si el usuario está logueado
            if (!localStorage.getItem('isLoggedIn')) {
                window.location.href = 'login.html';
                return;
            }
            
            // Mostrar email del usuario
            const userEmail = localStorage.getItem('userEmail');
            if (userEmail) {
                document.getElementById('userName').textContent = userEmail;
            }
            
            // Mostrar fecha actual
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Establecer fecha/hora actual en los formularios
            const currentDateTime = now.toISOString().slice(0, 16);
            document.querySelectorAll('input[type="datetime-local"]').forEach(input => {
                if (!input.value) {
                    input.value = currentDateTime;
                }
            });
        });

        // Funciones de navegación
        function showContent(contentId) {
            // Ocultar todas las áreas de contenido
            document.querySelectorAll('.content-area').forEach(area => {
                area.classList.remove('active');
            });
            
            // Mostrar el contenido seleccionado
            document.getElementById(contentId + '-content').classList.add('active');
            
            // Actualizar menú activo
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.menu-item').classList.add('active');
            
            // Actualizar título de página
            const titles = {
                'dashboard': 'Dashboard',
                'cosecha': 'Registro de Cosecha',
                'lote': 'Gestión de Lotes',
                'parametro-agua': 'Parámetros de Agua',
                'alimentacion': 'Registro de Alimentación',
                'venta': 'Registro de Venta'
            };
            document.getElementById('pageTitle').textContent = titles[contentId];
            
            // Cerrar sidebar en móvil
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        function logout() {
            if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('userEmail');
                window.location.href = 'login.html';
            }
        }

        // Event listeners para formularios
        document.getElementById('cosechaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Cosecha registrada exitosamente');
            this.reset();
        });

        document.getElementById('loteForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Lote creado exitosamente');
            this.reset();
        });

        document.getElementById('parametroAguaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Parámetros de agua registrados exitosamente');
            this.reset();
        });

        document.getElementById('alimentacionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Registro de alimentación guardado exitosamente');
            this.reset();
        });

        document.getElementById('ventaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Venta registrada exitosamente');
            this.reset();
        });

        // Cerrar sidebar al hacer clic fuera de él en móvil
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const menuBtn = document.querySelector('.mobile-menu-btn');
                
                if (!sidebar.contains(e.target) && !menuBtn.contains(e.target)) {
                    sidebar.classList.remove('open');
                }
            }
        });

        // Validaciones específicas
        document.getElementById('cosecha_cantidad').addEventListener('input', function() {
            if (this.value < 1) {
                this.setCustomValidity('La cantidad debe ser mayor a 0');
            } else {
                this.setCustomValidity('');
            }
        });

        document.getElementById('param_ph').addEventListener('input', function() {
            if (this.value < 0 || this.value > 14) {
                this.setCustomValidity('El pH debe estar entre 0 y 14');
            } else {
                this.setCustomValidity('');
            }
        });

        // Auto-guardar en localStorage (simulación)
        function autoSave(formId, data) {
            localStorage.setItem('draft_' + formId, JSON.stringify(data));
        }

        // Recuperar borradores
        function loadDraft(formId) {
            const draft = localStorage.getItem('draft_' + formId);
            if (draft) {
                const data = JSON.parse(draft);
                Object.keys(data).forEach(key => {
                    const field = document.getElementsByName(key)[0];
                    if (field) field.value = data[key];
                });
            }
        }
    </script>
</body>
</html>